## ----include=FALSE-------------------------------------------------------------------------------------------------------
opts_chunk$set(fig.width=8, fig.height=4, fig.pos='htb', out.width='\\textwidth',
               echo = TRUE)


## ----packages, warning=FALSE, message=FALSE, echo=FALSE------------------------------------------------------------------
library("tidyverse")


## ----echo=FALSE----------------------------------------------------------------------------------------------------------
set.seed(20220212)
n <- 673

write_csv(data.frame(individual = 1:n,
                     rating = rbinom(n, 10, 6.3/10)),
          file = "ikea_rating.csv")


## ----echo=TRUE-----------------------------------------------------------------------------------------------------------
satisfaction <- read_csv("ikea_rating.csv",
                     col_types = cols(
                       individual = col_double(),
                       rating = col_double()))


## ------------------------------------------------------------------------------------------------------------------------
n <- nrow(satisfaction)
n


## ------------------------------------------------------------------------------------------------------------------------
mn <- mean(satisfaction$rating)
mn


## ------------------------------------------------------------------------------------------------------------------------
s <- sd(satisfaction$rating)
s


## ------------------------------------------------------------------------------------------------------------------------
se <- s/sqrt(n)
1-pt((7-mn)/(se), df = n-1)


## ------------------------------------------------------------------------------------------------------------------------
a <- 1-0.95
mn + c(-1,1)*qt(1-a/2, df = n-1)*se


## ----echo=FALSE----------------------------------------------------------------------------------------------------------
y <- rbinom(15, size = 10, prob = 7/10)


## ------------------------------------------------------------------------------------------------------------------------
n2 <- 15
mn2 <- 6.8
s2 <- 1.01
se2 <- s2/sqrt(n2)


## ------------------------------------------------------------------------------------------------------------------------
1-pt((7-mn2)/se2, df = n2-1)


## ------------------------------------------------------------------------------------------------------------------------
a <- 1-0.95
mn2 + c(-1,1)*qt(1-a/2, df = n2-1)*se2


## ------------------------------------------------------------------------------------------------------------------------
n_reps <- 100000
mu_IKEA <- rt(n_reps, df =  n-1)*se  + mn
mu_your <- rt(n_reps, df = n2-1)*se2 + mn2
mean(mu_your > mu_IKEA)


## ------------------------------------------------------------------------------------------------------------------------
dlst <- function(x, df, location, scale) {
  dt((x-location)/scale, df = df)/scale
}

d <- data.frame(mu = seq(5, 8, length = 1001)) %>%
  mutate(IKEA = dlst(mu, df = n, location = mn, scale = se),
         new  = dlst(mu, df = 15, location = 6.8, scale = 1.01/sqrt(15))) %>%
  pivot_longer(cols = -mu, names_to = "app")

ggplot(d, aes(x = mu, y = value, color = app, linetype = app)) +
  geom_line() +
  theme_bw() +
  labs(x = "Mean", y = "Posterior",
       title = "Posterior belief about mean rating")

