## ----libraries, message=FALSE, warning=FALSE, cache=FALSE, echo=FALSE-------------------------------------------------
library("tidyverse"); theme_set(theme_bw())
library("Sleuth3")
library("ggResidpanel")
library("emmeans")


## ----set_seed, echo=FALSE---------------------------------------------------------------------------------------------
set.seed(20220215)


## ---------------------------------------------------------------------------------------------------------------------
head(warpbreaks)
summary(warpbreaks)


## ---------------------------------------------------------------------------------------------------------------------
g <- ggplot(warpbreaks, aes(x = tension, y = breaks,
                          color = wool, shape = wool, group = wool)) +
  geom_jitter(width=0.1, height=0) + scale_y_log10()
g


## ---------------------------------------------------------------------------------------------------------------------
g + stat_summary(fun = mean, geom = "line")


## ---------------------------------------------------------------------------------------------------------------------
mM <- glm(breaks ~ wool + tension, data = warpbreaks, family = poisson) # Main effects model
mI <- glm(breaks ~ wool * tension, data = warpbreaks, family = poisson) # Interaction model

drop1(mI, test="Chi")


## ---------------------------------------------------------------------------------------------------------------------
resid_panel(mM, plots = c("qq", "resid", "index", "cookd"), qqbands = TRUE)


## ---------------------------------------------------------------------------------------------------------------------
summary(mM)


## ---------------------------------------------------------------------------------------------------------------------
em <- emmeans(mM, pairwise ~ wool)
cm <- confint(em, type  = "unlink"); cm


## ---------------------------------------------------------------------------------------------------------------------
et <- emmeans(mM, pairwise ~ tension)
ct <- confint(et, type  = "unlink"); ct


## ---------------------------------------------------------------------------------------------------------------------
g + geom_line(mapping=aes(y=predict(mM, warpbreaks, type  = "response")))


## ---------------------------------------------------------------------------------------------------------------------
summary(mI)


## ---------------------------------------------------------------------------------------------------------------------
em <- emmeans(mI, pairwise ~ wool | tension)
cm <- confint(em, type  = "unlink"); cm$emmeans


## ---------------------------------------------------------------------------------------------------------------------
cm$contrasts


## ---------------------------------------------------------------------------------------------------------------------
et <- emmeans(mI, pairwise ~ tension | wool)
ct <- confint(et, type  = "unlink"); ct$contrasts


## ---------------------------------------------------------------------------------------------------------------------
g + stat_summary(fun = mean, geom = "line")


## ---------------------------------------------------------------------------------------------------------------------
head(case2001)
summary(case2001)


## ---------------------------------------------------------------------------------------------------------------------
g <- ggplot(case2001, aes(x = Age, y = Status, color = Sex, shape = Sex)) +
  geom_jitter(width=0, height = 0.05)
g


## ---------------------------------------------------------------------------------------------------------------------
mM <- glm(Status == "Survived" ~ Sex + Age, data = case2001, family = binomial) # Main effects model
mI <- glm(Status == "Survived" ~ Sex * Age, data = case2001, family = binomial) # Interaction model

drop1(mI, test="Chi")


## ---------------------------------------------------------------------------------------------------------------------
resid_panel(mM, plots = c("qq", "resid", "index", "cookd"), qqbands = TRUE)


## ---------------------------------------------------------------------------------------------------------------------
summary(mM)


## ---------------------------------------------------------------------------------------------------------------------
em <- emmeans(mM, pairwise ~ Sex | Age, at = list(Age = c(15,28,65)))
cm <- confint(em, type = "unlink"); cm$emmeans


## ---------------------------------------------------------------------------------------------------------------------
cm$contrasts


## ---------------------------------------------------------------------------------------------------------------------
et <- emtrends(mM, pairwise ~ Sex, var = "Age")
ct <- confint(et); ct


## ---------------------------------------------------------------------------------------------------------------------
g + geom_smooth(mapping=aes(y=predict(mM, case2001, type="response")+1))


## ---------------------------------------------------------------------------------------------------------------------
summary(mI)


## ---------------------------------------------------------------------------------------------------------------------
em <- emmeans(mI, pairwise ~ Sex | Age, at = list(Age = c(15,28,65)))
cm <- confint(em, type = "unlink"); cm$emmeans


## ---------------------------------------------------------------------------------------------------------------------
cm$contrasts


## ---------------------------------------------------------------------------------------------------------------------
et <- emtrends(mI, pairwise ~ Sex, var = "Age")
ct <- confint(et); ct


## ---------------------------------------------------------------------------------------------------------------------
g + geom_smooth(mapping=aes(y=predict(mI, case2001, type="response")+1))

